# 机器人编程软件需求规格书

## 1. 引言

### 1.1 文档目的
本文档详细描述机器人编程软件的功能需求、使用流程、异常处理等内容，作为软件设计和开发的基础依据。

### 1.2 术语定义
- **嵌入式设备**：作为机器人大脑的硬件设备，包含底盘、传感器、执行器等部件
- **配置文件**：定义机器人硬件组件和功能的JSON/YAML格式文件
- **编程区**：用户进行图形化编程的主要工作区域
- **函数模块**：可拖拽的编程元素，包括逻辑块和功能块
- **逻辑块**：基础的编程逻辑组件，如条件判断、循环等
- **功能块**：与机器人硬件交互的组件，如电机控制、传感器读取等
- **变量区**：显示和管理变量的区域
- **只读变量**：设备状态信息，用户只能读取不能修改
- **读写变量**：用户可读取和修改的设备控制变量
- **局部变量**：用户在编程过程中创建的临时变量

## 2. 功能需求

### 2.1 配置文件管理

#### 2.1.1 配置文件加载
- **功能描述**：软件应能加载和解析机器人配置文件
- **输入**：配置文件路径（JSON/YAML格式）
- **输出**：加载成功提示，变量区和函数模块区更新
- **操作流程**：
  1. 用户通过菜单或工具栏选择"加载配置文件"
  2. 系统打开文件选择对话框
  3. 用户选择有效的配置文件
  4. 系统解析配置文件，更新界面元素
- **异常处理**：
  - 文件不存在：显示错误提示"文件不存在"
  - 文件格式错误：显示错误提示"配置文件格式错误"
  - 文件内容不完整：显示警告提示"配置文件内容不完整，部分功能可能受限"

#### 2.1.2 配置文件验证
- **功能描述**：软件应验证配置文件的有效性和完整性
- **操作流程**：加载配置文件时自动执行验证
- **异常处理**：
  - 缺少必要字段：显示错误提示"配置文件缺少必要字段：XXX"
  - 字段值类型错误：显示错误提示"字段XXX的值类型错误"
  - 字段值范围错误：显示警告提示"字段XXX的值超出建议范围"

### 2.2 变量区管理

#### 2.2.1 变量显示
- **功能描述**：显示设备的只读变量、读写变量和用户创建的局部变量
- **变量分类**：
  - 只读变量：设备状态信息（如传感器数据、当前位置等）
  - 读写变量：设备控制参数（如速度、角度等）
  - 局部变量：用户创建的变量（支持不同数据类型）
- **变量属性**：
  - 名称：变量标识
  - 类型：数据类型（整数、浮点数、布尔值、字符串等）
  - 值：当前值
  - 描述：变量说明
  - 读写权限：只读/读写
- **操作流程**：配置文件加载后自动显示相应变量

#### 2.2.2 局部变量创建
- **功能描述**：用户可以创建、编辑、删除局部变量
- **输入**：变量名称、类型、初始值、描述
- **操作流程**：
  1. 用户点击"创建变量"按钮
  2. 系统弹出变量创建对话框
  3. 用户输入变量信息
  4. 系统验证并创建变量
  5. 变量显示在变量区
- **异常处理**：
  - 变量名重复：显示错误提示"变量名已存在"
  - 变量名格式错误：显示错误提示"变量名格式不正确"
  - 初始值类型不匹配：显示错误提示"初始值与变量类型不匹配"

#### 2.2.3 变量拖拽
- **功能描述**：支持从变量区拖拽变量到编程区
- **操作流程**：
  1. 用户鼠标选中变量
  2. 按住鼠标左键拖拽到编程区
  3. 释放鼠标，变量块显示在编程区
- **异常处理**：
  - 拖拽到不允许位置：显示视觉反馈（如红色提示），变量返回原位置

### 2.3 函数模块区管理

#### 2.3.1 函数模块显示
- **功能描述**：根据配置文件显示可用的函数模块
- **模块分类**：
  - 逻辑块：条件判断、循环、等待、事件处理等
  - 设备功能块：电机控制、传感器数据获取、状态查询等
- **模块属性**：
  - 名称：模块标识
  - 图标：模块视觉表示
  - 描述：模块功能说明
  - 输入参数：所需参数列表
  - 输出参数：返回值列表
- **操作流程**：配置文件加载后自动显示相应函数模块

#### 2.3.2 函数模块拖拽
- **功能描述**：支持从函数模块区拖拽模块到编程区
- **操作流程**：
  1. 用户鼠标选中函数模块
  2. 按住鼠标左键拖拽到编程区
  3. 释放鼠标，函数模块块显示在编程区，并展开参数输入区域
- **异常处理**：
  - 拖拽到不允许位置：显示视觉反馈，模块返回原位置

### 2.4 编程区功能

#### 2.4.1 程序编辑
- **功能描述**：用户通过拖拽方式创建和编辑程序
- **支持操作**：
  - 拖拽放置：将模块放置到编程区
  - 连接模块：建立模块间的执行顺序关系
  - 调整位置：移动已有模块位置
  - 删除模块：移除不需要的模块
  - 复制粘贴：复制和粘贴模块
  - 嵌套模块：支持条件块、循环块内嵌套其他模块
- **操作流程**：
  1. 用户从函数模块区拖拽模块到编程区
  2. 系统显示可放置位置（高亮提示）
  3. 用户释放鼠标，模块放置
  4. 用户可拖拽变量到模块参数输入区
  5. 用户可拖拽其他模块并连接
- **异常处理**：
  - 无效连接：显示错误提示"模块类型不兼容"
  - 参数不匹配：显示错误提示"参数类型不匹配"
  - 嵌套层级超限：显示警告提示"嵌套层级过深"

#### 2.4.2 参数配置
- **功能描述**：配置函数模块的输入输出参数
- **参数输入方式**：
  - 直接输入：用户手动输入值
  - 变量拖拽：从变量区拖拽变量到参数位置
  - 表达式：支持简单数学运算和逻辑表达式
- **操作流程**：
  1. 用户点击模块参数区域
  2. 系统显示参数输入界面
  3. 用户输入值或拖拽变量
  4. 系统验证参数有效性
- **异常处理**：
  - 参数类型错误：显示错误提示"参数类型错误"
  - 参数值范围错误：显示警告提示"参数值超出范围"
  - 表达式语法错误：显示错误提示"表达式语法错误"

#### 2.4.3 程序验证
- **功能描述**：验证程序的语法正确性和逻辑合理性
- **验证内容**：
  - 模块连接完整性
  - 参数配置有效性
  - 变量引用有效性
  - 语法规则遵守情况
- **操作流程**：
  1. 用户点击"验证程序"按钮
  2. 系统执行验证
  3. 系统显示验证结果和错误提示
- **异常处理**：
  - 验证失败：显示详细错误信息，高亮显示错误位置
  - 警告提示：显示潜在问题但允许继续执行

### 2.5 程序管理

#### 2.5.1 程序保存
- **功能描述**：保存用户创建的程序
- **文件格式**：JSON/YAML格式，包含完整的程序结构和参数
- **操作流程**：
  1. 用户通过菜单或工具栏选择"保存程序"
  2. 系统打开文件保存对话框
  3. 用户指定文件名和路径
  4. 系统保存程序
- **异常处理**：
  - 保存失败：显示错误提示"保存失败"
  - 权限不足：显示错误提示"没有写入权限"

#### 2.5.2 程序加载
- **功能描述**：加载已保存的程序
- **操作流程**：
  1. 用户通过菜单或工具栏选择"加载程序"
  2. 系统打开文件选择对话框
  3. 用户选择程序文件
  4. 系统加载并显示程序
- **异常处理**：
  - 文件不存在：显示错误提示"文件不存在"
  - 文件格式错误：显示错误提示"程序文件格式错误"
  - 程序版本不兼容：显示警告提示"程序版本与当前软件不兼容"

#### 2.5.3 程序导出
- **功能描述**：将图形化程序导出为可在嵌入式设备上执行的代码
- **导出格式**：根据嵌入式设备要求的代码格式
- **操作流程**：
  1. 用户点击"导出程序"按钮
  2. 系统执行导出操作
  3. 系统提示导出成功并显示文件位置
- **异常处理**：
  - 导出失败：显示错误提示"导出失败"
  - 程序有错误：显示错误提示"程序存在错误，请先修复"

### 2.6 设备交互

#### 2.6.1 设备连接
- **功能描述**：建立与嵌入式设备的通信连接
- **连接方式**：支持USB、网络等多种连接方式
- **操作流程**：
  1. 用户点击"连接设备"按钮
  2. 系统显示可用设备列表
  3. 用户选择设备并确认连接
  4. 系统建立连接并更新状态
- **异常处理**：
  - 连接失败：显示错误提示"设备连接失败"
  - 设备不响应：显示错误提示"设备无响应"
  - 通信超时：显示错误提示"通信超时"

#### 2.6.2 程序执行
- **功能描述**：将程序传输到设备并执行
- **操作流程**：
  1. 用户点击"执行程序"按钮
  2. 系统验证程序
  3. 系统传输程序到设备
  4. 设备执行程序
  5. 系统显示执行状态
- **异常处理**：
  - 执行失败：显示错误提示"程序执行失败"
  - 执行中断：显示提示"程序执行已中断"
  - 设备错误：显示设备返回的错误信息

#### 2.6.3 变量监控
- **功能描述**：实时监控设备变量的值变化
- **操作流程**：
  1. 用户选择要监控的变量
  2. 系统建立变量监控
  3. 变量区显示实时更新的变量值
- **异常处理**：
  - 监控失败：显示警告提示"变量监控失败"
  - 更新延迟：显示警告提示"数据更新延迟"

## 3. 非功能需求

### 3.1 性能需求
- 拖拽操作响应时间不超过100ms
- 程序验证时间不超过1秒（常规复杂度程序）
- 支持同时监控至少100个变量
- 界面流畅支持至少100个模块的程序编辑

### 3.2 可用性需求
- 界面设计符合直观易用原则
- 提供详细的操作提示和帮助文档
- 支持键盘快捷键操作
- 提供操作撤销/重做功能
- 支持多种分辨率显示，最小支持1024x768

### 3.3 可靠性需求
- 程序自动保存功能，防止意外退出数据丢失
- 错误恢复机制，程序崩溃后可恢复最近状态
- 通信错误自动重试机制
- 支持长时间稳定运行（>24小时）

### 3.4 安全性需求
- 配置文件和程序文件验证，防止恶意文件
- 设备通信加密（如适用）
- 用户操作权限管理
- 错误操作确认机制

## 4. 系统架构

### 4.1 整体架构
- **前端界面层**：Qt图形界面，负责用户交互
- **业务逻辑层**：Python实现的核心功能
- **设备通信层**：与嵌入式设备的通信接口
- **数据存储层**：配置文件、程序文件的读写

### 4.2 模块划分
- **配置管理模块**：处理配置文件的加载和解析
- **变量管理模块**：管理变量的显示、创建、编辑
- **函数模块管理模块**：管理函数模块的显示和分类
- **编程区管理模块**：处理程序的编辑、验证、执行
- **设备通信模块**：负责与嵌入式设备的通信
- **文件管理模块**：处理程序的保存、加载、导出

## 5. 界面设计

### 5.1 整体布局
- 顶部：菜单栏、工具栏
- 左侧：变量区、函数模块区
- 中央：编程区
- 底部：状态栏、消息提示区

### 5.2 变量区设计
- 分标签页显示只读变量、读写变量、局部变量
- 每个变量显示名称、类型、当前值
- 支持搜索和过滤功能
- 提供变量创建、编辑、删除按钮

### 5.3 函数模块区设计
- 分标签页显示逻辑块、设备功能块等
- 模块以图标+名称方式显示
- 提供搜索和过滤功能
- 鼠标悬停显示模块详细说明

### 5.4 编程区设计
- 网格背景，方便对齐
- 模块以彩色块方式显示，不同类型颜色区分
- 模块间以连线表示执行顺序
- 支持缩放和平移操作
- 提供程序层级折叠/展开功能

## 6. 实现技术

### 6.1 技术栈
- **界面框架**：Qt 5.x/6.x
- **编程语言**：Python 3.x
- **GUI绑定**：PyQt5/PySide6
- **数据序列化**：JSON/YAML
- **通信协议**：自定义协议或标准工业协议

### 6.2 第三方库
- **PyQt5/PySide6**：GUI实现
- **PyYAML**：YAML文件处理
- **numpy**：数据处理
- **pyserial**：串口通信（如适用）

## 7. 测试要求

### 7.1 功能测试
- 验证所有功能点是否按需求实现
- 测试各种边界条件
- 测试异常情况下的系统响应

### 7.2 性能测试
- 测试拖拽操作响应时间
- 测试大量模块下的界面性能
- 测试变量监控的实时性

### 7.3 兼容性测试
- 测试不同分辨率显示
- 测试不同操作系统兼容性
- 测试不同版本配置文件兼容性

### 7.4 可用性测试
- 用户体验评估
- 操作流程合理性检查
- 错误提示信息清晰度检查

## 8. 项目管理

### 8.1 开发阶段
- 需求分析与规格制定
- 原型设计与用户确认
- 详细设计
- 编码实现
- 测试与调试
- 文档编写
- 发布与维护

### 8.2 里程碑
- 需求规格确认：项目启动后1周
- 原型设计完成：项目启动后2周
- 核心功能实现：项目启动后6周
- 测试完成：项目启动后8周
- 正式发布：项目启动后10周

### 8.3 风险管理
- 需求变更风险：建立变更管理流程
- 技术实现风险：提前进行技术验证
- 时间进度风险：合理规划任务，设置缓冲时间
- 质量风险：建立代码审查和测试机制